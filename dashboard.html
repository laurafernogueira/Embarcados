<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel da Seguradora - Telemetria IoT</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status-seguro { color: green; font-weight: bold; }
        .status-arriscado { color: red; font-weight: bold; }
        h1 { color: #2c3e50; }
    </style>
</head>
<body>
    <h1>üìä Monitoramento em Tempo Real - Seguradora</h1>
    
    <div class="grid">
        <div class="card">
            <h2>√öltimo Evento</h2>
            <div id="dados-atuais">Carregando...</div>
        </div>

        <div class="card">
            <h2>Hist√≥rico de Velocidade</h2>
            <canvas id="graficoVelocidade"></canvas>
        </div>
    </div>

  <script>
        // Use o seu link do Render aqui
        const API_URL = "https://embarcados-1.onrender.com/api/dados-recentes"; 

        async function atualizarDashboard() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                if (data.total > 0) {
                    // Pegamos o dado mais recente (primeiro da lista)
                    const ultimo = data.dados[0];
                    
                    // Define a cor baseada na classifica√ß√£o do Machine Learning
                    const estiloClasse = ultimo.classificacao.classificacao_ml === 'arriscado' ? 'status-arriscado' : 'status-seguro';
                    
                    // Atualiza os textos no HTML
                    document.getElementById('dados-atuais').innerHTML = `
                        <p><strong>Ve√≠culo ID:</strong> ${ultimo.veiculo_id}</p>
                        <p><strong>Motorista:</strong> ${ultimo.motorista_id}</p>
                        <hr>
                        <p><strong>Velocidade:</strong> ${ultimo.dados.velocidade} km/h</p>
                        <p><strong>Acelera√ß√£o:</strong> ${ultimo.dados.aceleracao_ms2} m/s¬≤</p>
                        <p><strong>RPM:</strong> ${ultimo.dados.rpm}</p>
                        <p><strong>Pedal Acelerador:</strong> ${ultimo.dados.pedal_acelerador_pct}%</p>
                        <hr>
                        <p><strong>An√°lise ML:</strong> <span class="${estiloClasse}">${ultimo.classificacao.classificacao_ml.toUpperCase()}</span></p>
                        <p><strong>Confian√ßa:</strong> ${(ultimo.classificacao.confianca * 100).toFixed(1)}%</p>
                        <p><small>√öltima atualiza√ß√£o: ${new Date(ultimo.timestamp).toLocaleString()}</small></p>
                    `;
                } else {
                    document.getElementById('dados-atuais').innerHTML = "Aguardando dados do ve√≠culo...";
                }
            } catch (error) {
                console.error("Erro ao buscar dados:", error);
                document.getElementById('dados-atuais').innerHTML = "Erro ao conectar com o servidor.";
            }
        }

        // Faz o dashboard atualizar sozinho a cada 3 segundos
        setInterval(atualizarDashboard, 3000);
        
        // Carrega uma vez assim que abre a p√°gina
        atualizarDashboard();
    </script>
</body>
</html>
